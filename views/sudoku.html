<!DOCTYPE html>
<html>
  <head>
    <title>Sudoku Solver</title>
    <meta
      name="description"
      content="An example for the fCC QA Sudoku Solver project"
    />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel = "stylesheet"
      href = sudokuStyle.css />
  </head>
  <body>
    <header>
      <h1>Quality Assurance 4: Sudoku Solver</h1>
    </header>
    <div id="user-stories">
      <h3>User Stories</h3>
      <ol>
        <li>
          I can enter a sudoku puzzle by filling in the text area with either a
          number or period (.) to represent an empty cell.
        </li>
        <li>
          When a valid number is entered in the text area, the same number is
          applied to the correct cell of the sudoku grid.
        </li>
        <li>
          I can enter a sudoku puzzle by adding numbers directly to the sudoku
          grid.
        </li>
        <li>
          When a valid number is entered in the sudoku grid, the same number
          appears in the correct position in the text area.
        </li>
        <li>
          The text area should only update the corresponding sudoku grid cell
          when a whole number between 1 and 9 is entered.
        </li>
        <li>
          The sudoku grid should only update the puzzle string in the text area
          when a whole number between 1 and 9 is entered into a cell.
        </li>
        <li>
          I can solve an incomplete puzzle by clicking the "Solve" button. When
          a solution is found, the sudoku grid and text area are automatically
          populated with the correct numbers for each cell in the grid or
          position in the text area.
        </li>
        <li>
          This sudoku solver is not expected to be able to solve every
          incomplete puzzle. See
          <code>/public/puzzle-strings.js</code> for a list of puzzle strings it
          should be able to solve along with their solutions.
        </li>
        <li>
          If the puzzle is not 81 numbers or periods long, append the message
          "Error: Expected puzzle to be 81 characters long." to the
          <code>error-msg</code> <code>div</code> so the text appears in red.
        </li>
        <li>
          I can clear the text area and sudoku grid by clicking the "Clear"
          button.
        </li>
        <li>
          All 6 unit tests are complete and passing. See
          <code>/tests/1_unit-tests.js</code> for the expected behavior you
          should write tests for.
        </li>
        <li>
          All 4 functional tests are complete and passing. See
          <code>/tests/2_functional-tests.js</code> for the functionality you
          should write tests for.
        </li>
      </ol>
    </div>
    <hr style="margin: 25px" />
    <div class="container">
      <div class="form-container">
        <textarea rows="10" cols="85" id="text-input"></textarea>
        <br />
        <input type="button" value="Solve" id="solve-button" />
        <input type="button" value="Clear" id="clear-button" />
        <div id="error-msg"></div>
      </div>
      <div id="sudoku-grid">
        <table class="grid">
          <tbody>
            <tr>
              <td class="A1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A1"
                  class="sudoku-input"
                />
              </td>
              <td class="A2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A2"
                  class="sudoku-input"
                />
              </td>
              <td class="A3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A3"
                  class="sudoku-input"
                />
              </td>
              <td class="A4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A4"
                  class="sudoku-input"
                />
              </td>
              <td class="A5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A5"
                  class="sudoku-input"
                />
              </td>
              <td class="A6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A6"
                  class="sudoku-input"
                />
              </td>
              <td class="A7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A7"
                  class="sudoku-input"
                />
              </td>
              <td class="A8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A8"
                  class="sudoku-input"
                />
              </td>
              <td class="A9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="A9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="B1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B1"
                  class="sudoku-input"
                />
              </td>
              <td class="B2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B2"
                  class="sudoku-input"
                />
              </td>
              <td class="B3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B3"
                  class="sudoku-input"
                />
              </td>
              <td class="B4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B4"
                  class="sudoku-input"
                />
              </td>
              <td class="B5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B5"
                  class="sudoku-input"
                />
              </td>
              <td class="B6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B6"
                  class="sudoku-input"
                />
              </td>
              <td class="B7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B7"
                  class="sudoku-input"
                />
              </td>
              <td class="B8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B8"
                  class="sudoku-input"
                />
              </td>
              <td class="B9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="B9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="C1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C1"
                  class="sudoku-input"
                />
              </td>
              <td class="C2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C2"
                  class="sudoku-input"
                />
              </td>
              <td class="C3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C3"
                  class="sudoku-input"
                />
              </td>
              <td class="C4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C4"
                  class="sudoku-input"
                />
              </td>
              <td class="C5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C5"
                  class="sudoku-input"
                />
              </td>
              <td class="C6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C6"
                  class="sudoku-input"
                />
              </td>
              <td class="C7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C7"
                  class="sudoku-input"
                />
              </td>
              <td class="C8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C8"
                  class="sudoku-input"
                />
              </td>
              <td class="C9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="C9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="D1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D1"
                  class="sudoku-input"
                />
              </td>
              <td class="D2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D2"
                  class="sudoku-input"
                />
              </td>
              <td class="D3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D3"
                  class="sudoku-input"
                />
              </td>
              <td class="D4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D4"
                  class="sudoku-input"
                />
              </td>
              <td class="D5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D5"
                  class="sudoku-input"
                />
              </td>
              <td class="D6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D6"
                  class="sudoku-input"
                />
              </td>
              <td class="D7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D7"
                  class="sudoku-input"
                />
              </td>
              <td class="D8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D8"
                  class="sudoku-input"
                />
              </td>
              <td class="D9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="D9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="E1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E1"
                  class="sudoku-input"
                />
              </td>
              <td class="E2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E2"
                  class="sudoku-input"
                />
              </td>
              <td class="E3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E3"
                  class="sudoku-input"
                />
              </td>
              <td class="E4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E4"
                  class="sudoku-input"
                />
              </td>
              <td class="E5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E5"
                  class="sudoku-input"
                />
              </td>
              <td class="E6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E6"
                  class="sudoku-input"
                />
              </td>
              <td class="E7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E7"
                  class="sudoku-input"
                />
              </td>
              <td class="E8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E8"
                  class="sudoku-input"
                />
              </td>
              <td class="E9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="E9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="F1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F1"
                  class="sudoku-input"
                />
              </td>
              <td class="F2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F2"
                  class="sudoku-input"
                />
              </td>
              <td class="F3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F3"
                  class="sudoku-input"
                />
              </td>
              <td class="F4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F4"
                  class="sudoku-input"
                />
              </td>
              <td class="F5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F5"
                  class="sudoku-input"
                />
              </td>
              <td class="F6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F6"
                  class="sudoku-input"
                />
              </td>
              <td class="F7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F7"
                  class="sudoku-input"
                />
              </td>
              <td class="F8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F8"
                  class="sudoku-input"
                />
              </td>
              <td class="F9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="F9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="G1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G1"
                  class="sudoku-input"
                />
              </td>
              <td class="G2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G2"
                  class="sudoku-input"
                />
              </td>
              <td class="G3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G3"
                  class="sudoku-input"
                />
              </td>
              <td class="G4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G4"
                  class="sudoku-input"
                />
              </td>
              <td class="G5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G5"
                  class="sudoku-input"
                />
              </td>
              <td class="G6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G6"
                  class="sudoku-input"
                />
              </td>
              <td class="G7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G7"
                  class="sudoku-input"
                />
              </td>
              <td class="G8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G8"
                  class="sudoku-input"
                />
              </td>
              <td class="G9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="G9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="H1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H1"
                  class="sudoku-input"
                />
              </td>
              <td class="H2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H2"
                  class="sudoku-input"
                />
              </td>
              <td class="H3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H3"
                  class="sudoku-input"
                />
              </td>
              <td class="H4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H4"
                  class="sudoku-input"
                />
              </td>
              <td class="H5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H5"
                  class="sudoku-input"
                />
              </td>
              <td class="H6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H6"
                  class="sudoku-input"
                />
              </td>
              <td class="H7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H7"
                  class="sudoku-input"
                />
              </td>
              <td class="H8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H8"
                  class="sudoku-input"
                />
              </td>
              <td class="H9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="H9"
                  class="sudoku-input"
                />
              </td>
            </tr>
            <tr>
              <td class="I1">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I1"
                  class="sudoku-input"
                />
              </td>
              <td class="I2">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I2"
                  class="sudoku-input"
                />
              </td>
              <td class="I3">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I3"
                  class="sudoku-input"
                />
              </td>
              <td class="I4">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I4"
                  class="sudoku-input"
                />
              </td>
              <td class="I5">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I5"
                  class="sudoku-input"
                />
              </td>
              <td class="I6">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I6"
                  class="sudoku-input"
                />
              </td>
              <td class="I7">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I7"
                  class="sudoku-input"
                />
              </td>
              <td class="I8">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I8"
                  class="sudoku-input"
                />
              </td>
              <td class="I9">
                <input
                  autocomplete="disabled"
                  type="text"
                  size="1"
                  maxlength="1"
                  id="I9"
                  class="sudoku-input"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
  <script>
    let textArea = document.getElementById("text-input");
    let solveButton = document.getElementById("solve-button");
    let clearButton = document.getElementById("clear-button");

    const puzzlesAndSolutions = [
      [
        "1.5..2.84..63.12.7.2..5.....9..1....8.2.3674.3.7.2..9.47...8..1..16....926914.37.",
        "135762984946381257728459613694517832812936745357824196473298561581673429269145378",
      ],
      [
        "5..91372.3...8.5.9.9.25..8.68.47.23...95..46.7.4.....5.2.......4..8916..85.72...3",
        "568913724342687519197254386685479231219538467734162895926345178473891652851726943",
      ],
      [
        "..839.7.575.....964..1.......16.29846.9.312.7..754.....62..5.78.8...3.2...492...1",
        "218396745753284196496157832531672984649831257827549613962415378185763429374928561",
      ],
      [
        ".7.89.....5....3.4.2..4..1.5689..472...6.....1.7.5.63873.1.2.8.6..47.1..2.9.387.6",
        "473891265851726394926345817568913472342687951197254638734162589685479123219538746",
      ],
      [
        "82..4..6...16..89...98315.749.157.............53..4...96.415..81..7632..3...28.51",
        "827549163531672894649831527496157382218396475753284916962415738185763249374928651",
      ],
    ];

    let grid = puzzlesAndSolutions[Math.floor(Math.random() * 5)][0];
    let sudokuInputs = document.getElementsByClassName("sudoku-input");

    function range(size, startAt = 0) {
      return [...Array(size).keys()].map((i) => i + startAt);
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Load a simple puzzle into the text area
      textArea.value = grid;
      grid.split("").forEach((ele, idx) => {
        sudokuInputs[idx].value = /[1-9]/.test(ele) ? ele : "";
      });
      //console.log(textArea.value)
    });
    //console.log(sudokuInputs)

    // Using Array.from to convert sudokuInputs into an array as forEach only works with Arrays.
    Array.from(sudokuInputs).forEach((ele, idx) => {
      // Do stuff here
      ele.addEventListener("change", (event) => {
        let changedChar = /[1-9]/.test(ele.value) ? ele.value : ".";
        let newText =
          textArea.value.slice(0, idx) +
          changedChar +
          textArea.value.slice(idx + 1, textArea.value.length);
        textArea.value = newText;
      });
    });

    clearButton.addEventListener("click", () => {
      // Load a simple puzzle into the text area
      textArea.value = "";
      Array.from(sudokuInputs).forEach((ele, idx) => {
        ele.value = "";
      });
    });

    solveButton.addEventListener("click", () => {
      console.log(textArea.value.length);
      //console.log(textArea.innerText.length)
      if (textArea.value.length != 81) {
        return (document.getElementById("error-msg").innerHTML =
          "<span style='color: red'>Error: Expected puzzle to be 81 characters long.</span>");
      }
      // Load a simple puzzle into the text area
      let sudokuString = textArea.value;
      let rowsArray = [[], [], [], [], [], [], [], [], []];
      let columnsArray = [[], [], [], [], [], [], [], [], []];
      let gridsArray = [[], [], [], [], [], [], [], [], []];
      let boardState = [];

      sudokuString.split("").forEach((ele, idx) => {
        let rowIdx = Math.floor(idx / 9);
        let columnIdx = idx % 9;
        let gridIdx = (Math.floor(idx / 3) % 3) + Math.floor(idx / 27) * 3;

        rowsArray[rowIdx].push(ele);
        columnsArray[columnIdx].push(ele);
        gridsArray[gridIdx].push(ele);

        let pointObj = {
          index: idx,
          value: ele,
          row: rowIdx,
          column: columnIdx,
          grid: gridIdx,
        };
        boardState.push(pointObj);
      });

      console.log("Initial boardState", boardState);
      let currentIdx = 0;
      let lastModifiedIdxArray = [0];
      let lastModifiedValArray = [1];
      let backtracked = false;
      while (currentIdx < 81) {
        let pos = boardState[currentIdx];
        //let lastUsedNum = 1;
        if (pos.value == ".") {
          selectNum: for (var i = 1; i < 11; i++) {
            if (backtracked) {
              backtracked = false;
            }
            if (i < 10) {
              let ans = String(i);
              let checkIfValid =
                !rowsArray[pos.row].includes(ans) &&
                !columnsArray[pos.column].includes(ans) &&
                !gridsArray[pos.grid].includes(ans);
              if (checkIfValid) {
                pos.value = ans;
                rowsArray[pos.row][pos.column] = ans;
                columnsArray[pos.column][pos.row] = ans;
                gridsArray[pos.grid][
                  (pos.column % 3) + 3 * (pos.row % 3)
                ] = ans;
                lastModifiedValArray.push(i);
                lastModifiedIdxArray.push(currentIdx);
                backtracked = false;
                break selectNum;
              }
            } else {
              //Handles running out of available nums and needing to backtrack
              //console.log(`Backtracked from pos ${currentIdx} to pos ${lastModifiedIdxArray[lastModifiedIdxArray.length - 1]}`)
              backtracked = true;
              currentIdx =
                lastModifiedIdxArray[lastModifiedIdxArray.length - 1];
              lastModifiedIdxArray.pop();
              pos = boardState[currentIdx];
              pos.value = ".";
              rowsArray[pos.row][pos.column] = ".";
              columnsArray[pos.column][pos.row] = ".";
              gridsArray[pos.grid][(pos.column % 3) + 3 * (pos.row % 3)] = ".";
              i = lastModifiedValArray[lastModifiedValArray.length - 1];
              lastModifiedValArray.pop();
              continue;
            }
          }
        }

        currentIdx += 1;
      }

      // displays final solution

      console.log("Final boardState", boardState);
      let solutionString = "";
      for (let idx in boardState) {
        solutionString += boardState[idx].value;
      }
      textArea.value = solutionString;
      Array.from(sudokuInputs).forEach((ele, idx) => {
        // Do stuff here
        ele.value = solutionString[idx];
      });
      console.log(solutionString);
    });
  </script>
</html>
